## Link-state 알고리즘

최소비용기준 알고리즘  - 링크상태의 DB를 사용해 목적지까지의 여러 가능한 경로들 중에서, 각 링크비용합에 기반하여 최소의 경로비용을 계산하는 라우팅 알고리즘

- 거리와 대역폭에 따라 경로계산, 라우팅 정보 변화 시 변경 정보 전달의 장점이 있다.
- 모든 라우팅 정보 관리로 메모리 소모 SPF계산 등 CPU 로드 소요의 단점이 있다. 
- 대규모 네트워크에 어울림
- 다익스트라 알고리즘을 내부적으로 사용하고 있다.
- 네트워크 전체 인식
- 홉,지연 , 대역폭 등 다양한 변수를 고려한다. 
- 이벤트에 기반해 라우팅 테이블을 갱신한다.
- 인접 라우터와 링크 상태 정보를 교환한다. 
- 프로토콜로 OSFP, IS-IS 가 있다. 


## Distance-Vector 알고리즘
- 라우팅 테이블의 크기가 작아 메모리가 절약되고 라우팅 구성이 간단하다.
- 주기적 라우팅 정보 갱신 트래픽 낭비가 있다. 라우팅 정보 변화시 전달이 느리다.
- 소규모 네트워크에 적합함
- 벨만-포드 알고리즘
- 이웃한 라우터 시각 네트워크 인식
- 홉카운트로 계산
- 주기적으로 라우팅 테이블 갱신
- 인접 라우터와 거리 정보를 교환
- RIP, IGRP 프로토콜이 해당된다. 


### OSFP

#### 출현배경

-   1980년대 중반에 RIP 라우팅 프로토콜이 대규모 이질적인 망간 라우팅에 비효율
    -   IETF에서 SPF 알고리즘에 기초하여 공개(Open)적으로 개발되어 인터넷에 적용

#### 특징

-   Link State 기술에 의한 최단경로 선택 라우팅 알고리즘
    -   최단 경로를 선택하기 위해 다익스트라의 SPF(Shortest Path First) 알고리즘을 사용
-   빠른 재수렴 (Fast Reconvergence) 및 부분 갱신 (Partial Update)
    -   OSPF 라우터 각각이 전체 네트워크 토폴로지 정보를 갖으므로, 토폴로지 변화에 빠른 대처 가능
    -   네트워크가 안정되면(Convergence), 라우팅 갱신 정보 만이 전달됨
    -   즉, 링크 상태(Link State)의 변화시에 만 라우팅 정보를 전송

-   라우팅 메트릭으로  링크 비용 사용
    -   목적지까지의 최적 경로 선택을 위한 라우팅 메트릭으로는 Link Cost 사용
-   네트워크를 영역 단위로 나누어 구분 관리
    -   AS(자율시스템) 내부에 영역(Area) 개념을 두어, 2-level에 의한 계층적 라우팅 구현
-   라우터 인터페이스에 접속된 OSPF 네트워크 종류에 따라 동작 방식이 달라짐
-   VLSM(Variable Length Subnet Mask) 및 CIDR(Classless InterDomain Routing) 지원
    -   Classless Routing

#### OSPF 라우터

**주요 역할**

-   라우팅 정보 교환, 동일한 LSDB 유지, 최적 라우팅테이블 구축 등
-   이웃라우터에서 링크상태,라우터 정보를 수집 전달하고, 자신의 링크상태를 광고하고,
-   OSPF 영역 내의 모든 라우터는 동일한 링크상태 데이터베이스(LSDB)를 갖게되고,
-   SPF 알고리즘을 사용하여 최적 경로를 산출하며, 라우팅테이블을 구축함

**라우터 테이블**

-   Neighbor Table: 모든 인접 라우터들의 리스트 관리
-   Link State Database (LSDB) : 소속 망에 대한 Topology 관리 (LSA 패킷들로부터 구축됨)
-   Routing Table: LDSB를 이용하여 최적 경로 루트의 리스트 관리

#### OSPF 패킷

[![OSPF 패킷 구성.jpg](https://itwiki.kr/images/f/f1/OSPF_%ED%8C%A8%ED%82%B7_%EA%B5%AC%EC%84%B1.jpg)](https://itwiki.kr/w/%ED%8C%8C%EC%9D%BC:OSPF_%ED%8C%A8%ED%82%B7_%EA%B5%AC%EC%84%B1.jpg)

**패킷 종류**

-   Hello 패킷
-   DDP 패킷
-   LSR 패킷
-   LSU 패킷
-   LSAck 패킷

**OSPF 패킷 운반**

-   OSPF 메세지는 UDP/TCP 등을 사용하지 않고, 직접 IP 데이터그램(프로토콜 ID : 89)에 의해 운반됨

#### OSPF 멀티캐스트

멀티캐스트용 IPv4 주소

-   224.0.0.5 (ALLSPFRouters) : OSPF를 지원하는 모든 라우터에게
-   224.0.0.6 (ALLDRouters)   : DR(Designated Router)와 BDR에게

#### OSPF 네트워크

OSPF는 다른 라우팅 프로토콜과는 달리, 네트워크 종류별로 설정 및 동작방식이 다름

-   예시) BMA, NBMA, PTP 등

#### 표준

-   RFC 1131 (Version 1, 1989, 테스트로만 사용 후 폐기), RFC 2328 (Version 2, 1998)
    -   표준작업 1988~1991년


### RIP

**Routing Information Protocol**

-   가장 많이 사용되는 라우팅 프로토콜
-   홉(Hop)을 기준으로 하고 최대 15홉까지 지원하므로 큰 망에선 사용할 수 없다.
-   30초마다 모든 라우터에 정보를 업데이트한다.
-   180초 이내에 정보가 수신되지 않으면 해당 경로를 이상 상태로 간주한다.
-   거리 벡터 프로토콜이다.
-   **장점**
    -   경로 변화에 민감하게 반응하여 라우팅 정보를 갱신한다.
    -   구조가 간단하여 프로세서에 부담이 적다.
-   **단점**
    -   브로드캐스팅 방식이므로 네트워크에 부하를 준다.
    -   회선의 상태를 무시한 홉 수 계산 방식이므로 비효율적인 라우팅이 이루어질 수 있다.

#### 역사

-   1970년대 : 제록스社 팔로알토연구소(PARC)의 XNS(Xerox Network System) 프로토콜 군의 일부로써 GWINFO(게이트웨이 정보 프로토콜)를 개발
-   1980년대 : Berkeley UNIX BDS 4.2에서 Routed Daemon 으로 개발됨
    -   1982년 버클리 UNIX 배포판인 BSD 4.2에 routed 데몬 프로그램 포함 배포됨
    -   1988년   : RIPv1 (RFC 1058)
-   1994년   : RIPv2 (RFC 1723)
-   1997년   : RIPng (RFC 2080)

#### 특징
-   거리벡터 라우팅 프로토콜 임
-   라우팅 메트릭 으로 Hop Count (홉 수) 만 사용
-   경로비용을 단지 홉 수로 만 판단
    -   속도나 거리 지연 등을 고려하지 않아 최적의 경로 산정에 비효율적
-   최대 홉 수의 제한
    -   최대 15 홉 수(16은 무한대)로 제한
    -   홉(hop)수는 라우터를 통과할 때 마다 1 씩 증가하게 됨
-   [UDP](https://itwiki.kr/w/UDP "UDP") 세그먼트에 캡슐화되어 사용
    -   RIP 메세지 송수신용 UDP 포트
        -   RIPv1,RIPv2 : UDP [포트번호](https://itwiki.kr/w/%ED%8F%AC%ED%8A%B8_%EB%B2%88%ED%98%B8 "포트 번호") 520
        -   RIPng: UDP 포트번호 521

[![UDP 세그먼트에 캡슐화된 RIP 메시지.jpg](https://itwiki.kr/images/1/1b/UDP_%EC%84%B8%EA%B7%B8%EB%A8%BC%ED%8A%B8%EC%97%90_%EC%BA%A1%EC%8A%90%ED%99%94%EB%90%9C_RIP_%EB%A9%94%EC%8B%9C%EC%A7%80.jpg)](https://itwiki.kr/w/%ED%8C%8C%EC%9D%BC:UDP_%EC%84%B8%EA%B7%B8%EB%A8%BC%ED%8A%B8%EC%97%90_%EC%BA%A1%EC%8A%90%ED%99%94%EB%90%9C_RIP_%EB%A9%94%EC%8B%9C%EC%A7%80.jpg)

-   Classful Routing 수행
    -   Subnetwork 정보가 아닌 Class 형태의 라우팅 정보 만을 전달함으로써 라우팅 정보 전달량이 많음
    -   단, RIPv2 는 라우팅 업데이트 정보에 서브넷 마스크 정보를 포함하여 VLSM 지원

-   주기적인 라우팅 업데이트
    -   매 30초 마다 RIP 응답메세지(RIP 패킷)를 브로드캐스팅 함
        -   이때, 목적지 IP 주소를 255.255.255.255 (브로드캐스트 주소)로써 사용
    -   상대에게서 수신된 네트워크 정보를 제외한 모든 네트워크 정보를 상대에게 알려줌
    -   수신 라우터는 자신의 라우팅 테이블을 재작성하도록 함
        -   단, 네트워크 경로 항목에서 더 짧은 홉 수를 수신 받았을 때 만 해당 라우팅 경로 항목을 교체함

#### RIP 타이머
-   **Update 타이머:** 30초
    -   라우팅 테이블 전체를 브로드캐스트 또는 멀티캐스트 방식으로 송출
-   **Timeout 타이머: 180초**
    -   라우팅 테이블에 있는 매 경로 마다 만료(Timeout) 타이머를 둠
    -   업데이트 정보(RIP 응답메세지)에 해당 경로가 있으면 만료 타이머를 초기화하고, 만료 타이머 종료시까지 해당 경로가 없으면 도착 불가능(16,무한)으로 표시
-   **Garbage Collection 타이머:** 120초  (Garbage Collection Timer)
    -   도착불가능 16(무한)으로 표시하고 주변에 알리며, 즉각 삭제 유예하는 시간
-   **Flush 타이머:** 240초
    -   업데이트 없는 경로에 대해서는 라우팅 테이블에서 해당 경로를 제거
-   **Triggered Update (트리거 갱신)**
    -   토폴로지 변화시 업데이트 타이머 종료전이라도 즉각 라우팅 업데이트 정보 송출

#### RIP의 문제점과 해결 방안

##### 문제점

-   **Slow Convergence (늦은 수렴성)**
    -   라우터들끼리 주기적으로(30초 간격) 경로 업데이트를 하며 경로 재계산함에 따라 몇 개 라우터 만 지나도 수분 이상 걸림
-   **라우팅 트래픽 부하**
    -   전체 경로를 담은 라우팅 테이블을 주기적으로 보로드캐스트함에 따라 network에 이에따른 traffic 부하를 줌
-   **라우팅 루프**
    -   전 라우터들 사이에 동기화를 시켜주지 않으면 패킷의 경로가 부적절하게될 수 있음
    -   매 30초 마다 업데이트되는 까닭에 다운(Down) 등의 나쁜 소식이 늦게 전달되어 잘못된 경로로 무한 루프(Infinite Loop)를 도는 사태 발생
-   **Count-to-Infinity Problem**  
    -   느린 수렴 시간 때문에, 나쁜 경로를 다른 라우터에게 전하면 그 라우터는 더 느리게 더 나쁜 정보로써 다른 라우터에게 전하게되면서 결국 무한(16) 홉 수로 가는 현상

##### 해결 방안

-   최대 홉 수의 제한
-   Triggered Update
-   Holddown Timer
-   Split Horizon
-   Poison/Poison Reverse 등

### EIGRP

**시스코에서 1994년 독자적으로 개발한 라우팅 프로토콜**

-   기존 [IGRP(Interior Gateway Routing Protocol)](https://itwiki.kr/w/IGRP "IGRP") 보다 효율성,수렴성 면에서 많이 개선된 버전

#### 기술적 특징

-   **혼성(Hybrid) 라우팅 프로토콜**
    -   IGRP 처럼 Distance Vector Algorithm에 기초하여 라우팅 수행
    -   Link State Algorithm의 장점(부분적인 라우팅 정보의 업데이트, 이웃 발견 등)도 포함
    -   라우팅 알고리즘 : DUAL(Diffusing Update Algorithm)
-   **라우팅 메트릭은, IGRP 처럼 여러가지 메트릭(5가지)들을 사용**
    -   Bandwidth, Delay, Load, Reliability, MTU 중 조합하여 사용 가능 (Composite Metric)
    -   기본(default)으로 Bandwidth, Delay를 사용
    -   최적 경로(best route) 계산을 위해, Bandwidth가 필히 설정되어 있어야 함
-   **IGRP와는 달리 CIDR 및 VLSM 모두 지원**
-   **최대 홉수는 224**
-   **주기적인 라우팅 업데이트 하지 않음**
    -   토폴로지 변화가 있을 때 만 업데이트 수행
-   **동일하지 않은 라우팅 메트릭에서도 로드 밸런싱**

#### 패킷 종류
-   헬로우 패킷
-   업데이트 패킷
-   요청 패킷
-   응답 패킷
-   확인 패킷