# Cascade관련 정리
### DB에서 삭제시 옵션을 담당하는 Cascade 설정이 JPA에서는 어떻게 구현되어있고, 구현되어있는 방향에 따라서 어떻게 구현되는지 살펴볼 예정
* 엔티티간의 연관관계를 매핑할 때는 다음 3가지를 고려해야한다. (다중성, 단방향-양방향, 연관관계의 주인)
* 다중성 - 다중성에는 다대일, 일대다, 일대일, 다대다가 있다. 
* 연관관계의 주인
	* 데이터 베이스는 외래 키 하나로 두테이블이 연관관계를 맺는다. 따라서  테이블의 연관관계를 관리하는 포인트는 외래 키 하나이다. 반면에 엔티티를 양방향으로 매핑하면 A-> B/ B->A 두 곳에서 서로를 참조한다. 따라서 객체의 연관관계를 관리하는 포인트는 두 곳이다. 
	* JPA는 두 객체 연관관계 중 하나를 정해서 데이터 베이스 외래키를 관리하는데 이것을 연관관계의 주인이라고 표현한다. 따라서 A->B든 B->A든 둘 중 하나를 정해서 외래 키를 관리해야 한다. 외래 키를 가진 테이블과 매핑한 엔티티가 외래키를 관리하는게 효율적이므로 보통 이곳을 연관관계의 주인으로 정한다. **주인이 아닌 방향은 외래 키를 변경할 수 없고 읽기만 가능하다.**
	* 연관관계의 주인은 mappedBy 속성을 사용하지 않는다. 연관관계의 주인이 아니라면  mappedBy속성을 사용하고 연관관계의 주인 필드 이름을 값으로 
	입력해야한다. 


* 영속성 전이 _“CASCADE”_
	* 특정 엔티티를 영속 상태로 만들 때 연관된 엔티티도 함께 영속 상태로 만들고 싶으면 영속성 전이 기능을 사용하면 된다. JPA는 CASCADE 옵션으로 영속성 전이를 제공한다. 쉽게 말해서 영속성 전이를 사용하면 부모엔티티를 저장할 때 자식 엔티티도 저장할 수 있다.  
	* 영속성 전이는 연관관계 매핑과는 아무 관련이 없다????? ㅋㅋㅋㅋㅋ 단지 엔티티를 저장할 때, 관련 엔티티도 같이 영속화 되는 편리함을 제공할 뿐이다. 그래서 양방향 연관관계 추가 이후 -> 영속상태로 만들 것!
	* 삭제시 부모와 자식 엔티티를 모두 제거하려면 엔티티매니저에서 remove함수를 자식들 먼저 -> 부모제거하는 과정을 거쳐야한다. 
	* 이 경우 엔티티매니저에 부모 클래스를 find하도록 해서 모두를 영속화 시키고 삭제하는 방법이 존재한다. 만약 CascadeType.REMOVE를 설정하지 않고 이를 삭제하면 부모 엔티티만 삭제된다. 하지만 DB의 부모를 삭제하면 자식 테이블에 걸려있는 외래키 제약조건으로 데이터베이스에서 외채키 무결성 예외가 발생한다. 
	* 옵션으로는 ALL, PERSIST, MERGE, REMOVE, REFRESH, DETACH등이 있다.  